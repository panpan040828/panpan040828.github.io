---
layout: post
title: session和cookie的区别和联系
date: 2016-06-16
categories: http协议
tags: [http]
description: 
---

### 一. 理解session和cookie

HTTP协议本身是无状态的（每一次请求之间是独立的）

cookie的作用就是为了解决HTTP协议无状态的缺陷所作出的努力。

session机制则是又一种在客户端与服务器之间保持状态的解决方案。

> 让我们用几个例子来描述一下cookie和session机制之间的区别与联系。笔者曾经常去的一家咖啡店有喝5杯咖啡免费赠一杯咖啡的优惠，然而一次性消费5杯咖啡的机会微乎其微，这时就需要某种方式来纪录某位顾客的消费数量。想象一下其实也无外乎下面的几种方案： 

> 1、该店的店员很厉害，能记住每位顾客的消费数量，只要顾客一走进咖啡店，店员就知道该怎么对待了。这种做法就是协议本身支持状态。 

> 2、发给顾客一张卡片，上面记录着消费的数量，一般还有个有效期限。每次消费时，如果顾客出示这张卡片，则此次消费就会与以前或以后的消费相联系起来。这种做法就是在客户端保持状态。 

> 3、发给顾客一张会员卡，除了卡号之外什么信息也不纪录，每次消费时，如果顾客出示该卡片，则店员在店里的纪录本上找到这个卡号对应的纪录添加一些消费信息。这种做法就是在服务器端保持状态。

> 由于HTTP协议是无状态的，而出于种种考虑也不希望使之成为有状态的，因此，后面两种方案就成为现实的选择。具体来说cookie机制采用的是在客户端保持状态的方案，而session机制采用的是在服务器端保持状态的方案。同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，所以session机制可能需要借助于cookie机制来达到保存标识的目的，但实际上它还有其他选择。 

### 二. 理解cookie机制

cookies是服务器用来标识web用户的一小块数据。

cookies的基本思想就是让浏览器积累一组服务器特有的信息，并在客户端和服务器端来回传递。

- cookie如何分发
- cookie的内容
- 客户端如何使用cookie

#### 1. cookie如何分发

**a. 服务器在返回的响应报文中，通过Set-Cookie头部来设置cookie**

```
HTTP/1.1 200 OK
Content-type: text/html
Set-Cookie: name=value; domain="www.baidu.com";
```
**b. 客户端将set-cookie首部中的内容保存下来，在下次发送请求时携带**

```
GET /index.html HTTP/1.1
Cookie: name=value;
```
cookie的数据始终在同源的http请求中携带，并且会来回传递。

#### 2. cookie的内容

- 名称name: cookie的名称
- 值value: cookie中存放的内容
- 过期时间end: 表示cookie何时会被删除
- 域domain: cookie对于哪个域是有效的
- 路径path: 指定域中的某个路径
- 安全标志secure

只有名称和值会被浏览器传回服务器端，其它内容都是服务器给浏览器的指示，不会做为浏览器发送到服务器cookie的一部分

根据**过期时间**不同，将cookie分为**会话cookie**和**持久cookie**。

<font color="red">会话cookie和持久cookie的区别：</font>

**过期时间：**
	
	会话cookie：没有设定过期时间的cookie都会被当成会话cookie

	持久cookie：设置了过期时间的cookie是

**存储地点：**

    cookie都是存在客户端的。但是不同类型的cookie存在客户端的位置不一样。

    会话cookie：存储在内存里

    持久cookie：存储在硬盘上

**消失时间：**

    会话cookie：由于会话cookie是存在内存中的，内存又是相对于进程分配的，因此进程关闭，会话cookie就会消失。

			   对于多进程浏览器（chrome、IE 10），浏览器的一个标签页就是一个进程，在浏览器窗口(标签页)关闭之后就会消失；

			   对于多线程浏览器（firefox），浏览器的一个标签页是一个线程，只有当浏览器窗口关闭才会消失（所有浏览器窗口都是一个进程）。

    持久cookie：是在过期时间之后消失。

**是否被浏览器不同页面共享：**

	会话cookie：不同浏览器的处理方式不同。

			   对于多进程浏览器（chrome、IE 10），是不能被浏览器的不同标签页共享
				
			   对于多线程浏览器（firefox）,是可以被浏览器的不同标签页共享

			   一般来说是用javascript的window.open()打开的窗口会与原窗口共享内存cookie。

	持久cookie：是存在电脑硬盘里，是可以被同一个浏览器的所有页面共享的（无论是多进程还是多线程浏览器）；

**补充一点点：**

不同浏览器之间不能共享cookie，因为每个浏览器存cookie路径不是一样的。

### 三. 理解session机制

- session指的是会话，会话：指一个浏览器窗口打开到关闭的这个期间。
 
- session机制：是指的一种服务器端的机制。用来在客户端与服务器之间保持状态的解决方案。
 
**session的作用：**session是服务器用来识别不同用户的。

session是一种保存上下文信息的机制，它是针对每一个用户的，变量的值保存在服务器端，通过SessionID来区分不同的客户,session是以cookie或URL重写为基础的，默认使用cookie来实现。

**session**是保存在**服务器端**的；每个session会有一个唯一的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串。

**session id**是被保存在**客户端**的,可以在cookie中保存这个session id。

session（服务器端） <===============> session id（客户端）
  
> 当程序需要为某个客户端的请求创建一个session的时候，

> 服务器首先检查这个客户端的请求里是否已包含了一个session标识（称为session id），

> 如果已包含一个session id则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（如果检索不到，可能会新建一个）

> 如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，这个session id将被在本次响应中返回给客户端保存。 

关闭浏览器不会导致session被删除，服务器会为seesion设置了一个失效时间，当距离客户端上一次使用session的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把session删除以节省存储空间。

### 四. session和cookie的区别

- cookie数据存放在客户的浏览器上，session数据放在服务器上。
- cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗（例如：如果你在机器上面保存了某个论坛 cookie，有效期是一年，如果有人入侵你的机器，将你的  cookie拷走，然后放在他的浏览器的目录下面，那么他登录该网站的时候就是用你的的身份登录的。所以 cookie是可以伪造的。）；考虑到安全应当使用session。
- session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能；考虑到减轻服务器性能方面，应当使用cookie。
- 单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。
- 所以个人建议：将登陆信息等重要信息存放为session，其他信息如果需要保留，可以放在cookie中。

