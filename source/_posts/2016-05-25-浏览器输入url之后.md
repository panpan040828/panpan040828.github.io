---
layout: post
title: 输入url浏览器所做的工作
date: 2016-05-25
categories: 浏览器
tags: [浏览器]
description: 
---

### 一. 根据url请求页面的过程

#### 1. 浏览器查找域名对应的IP地址

- **IP 地址**：用来标识每个主机，类似于门牌号码
- **域名（ DN —— domain name ）**:容易记住的与ip对应的地址， 一个域名对应一个或多个提供相同服务服务器的 IP 地址
- **DNS（domain name system）**：，只有知道服务器 IP 地址才能建立连接，所以需要通过 DNS 把域名解析成一个 IP 地址。

<font color="red">注意：IP 地址与域名不是一一对应的关系：可以把多个提供相同服务的服务器 IP 设置为同一个域名，但在同一时刻一个域名只能解析出一个 IP地址；同时，一个 IP 地址可以绑定多个域名，数量不限</font>

**根据域名查找ip地址的过程：**

    （1）浏览器搜索自己的 DNS 缓存（维护一张域名与 IP 地址的对应表）；
    （2）搜索操作系统中的 DNS 缓存（维护一张域名与 IP 地址的对应表）；
    （3）搜索操作系统的 hosts 文件（ Windows 环境下，维护一张域名与 IP 地址的对应表）；
    （4）操作系统将域名发送至 LDNS（本地区域名服务器，如果你在学校接入互联网，则 LDNS 服务器就在学校，如果通过电信接入互联网，则 LDNS 服务器就在你当地的电信那里。）LDNS 查询 自己的 DNS 缓存（一般查找成功率在 80% 左右），查找成功则返回结果，失败则发起一个迭代 DNS 解析请求；
    	LDNS 向 Root Name Server （根域名服务器，其虽然没有每个域名的的具体信息，但存储了负责每个域，如 com、net、org等的解析的顶级域名服务器的地址）发起请求，此处，Root Name Server 返回 com 域的顶级域名服务器的地址；
    	LDNS 向 com 域的顶级域名服务器发起请求，返回 baidu.com 域名服务器地址；
    	LDNS 向 baidu.com 域名服务器发起请求，得到 www.baidu.com 的 IP 地址；
    （5）LDNS 将得到的 IP 地址返回给操作系统，同时自己也将 IP 地址缓存起来；
    （6）操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起来；
    （7）至此，浏览器已经得到了域名对应的 IP 地址。

#### 2. 建立连接

由1中知道了域名所对应的ip地址，便开始与服务器建立连接

**建立连接的过程如下（TCP协议-三次握手）：**

    （1）客户端向服务器发送一个建立连接的请求（您好，我想认识您）
    （2）服务器接到请求后发送同意连接的信号（好的，我同意认识您）
    （3）客户端接收到同意连接的信号之后，再次向服务器发送确认信号（我也很高兴认识您），自此，主机和服务器建立了连接。

#### 3. 网页请求与显示

在2中，主机与服务器建立了连接之后，便是主机与服务器进行通信。

    （1）浏览器根据 URL 内容生成 HTTP 请求，请求中包含请求文件的位置、请求文件的方式等等；
    （2）服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件；
    （3）服务器将得到的 HTML 文件发送给浏览器；
    （4）在浏览器还没有完全接收 HTML 文件时便开始渲染、显示网页；
    （5）在执行 HTML 中代码时，根据需要，浏览器会继续请求图片、CSS、JavsScript等文件，过程同请求 HTML ；

**HTML页面加载和解析流程**
    
    （1）用户输入网址（假设是个html页面，并且是第一次访问），浏览器向服务器发出请求，服务器返回html文件。 
    
    （2）浏览器开始载入html代码，发现<head>标签内有一个<link>标签引用外部CSS文件。 
    
    （3）浏览器又发出CSS文件的请求，服务器返回这个CSS文件。 
    
    （4）浏览器继续载入html中<body>部分的代码，并且CSS文件已经拿到手了，可以开始渲染页面了。 
    
    （5）浏览器在代码中发现一个<img>标签引用了一张图片，向服务器发出请求。此时浏览器不会等到图片下载完，而是继续渲染后面的代码。 
    
    （6）服务器返回图片文件，由于图片占用了一定面积，影响了后面段落的排布，因此浏览器需要回过头来重新渲染这部分代码。 
    
    （7）浏览器发现了一个包含一行Javascript代码的<script>标签，赶快运行它。 
    
    （8）Javascript脚本执行了这条语句，它命令浏览器隐藏掉代码中的某个<style>（style.display=”none”）。杯具啊，突然就少了这么一个元素，浏览器不得不重新渲染这部分代码。 
    
    （9）终于等到了</html>的到来，浏览器泪流满面…… 
    
    （10） 等等，还没完，用户点了一下界面中的“换肤”按钮，Javascript让浏览器换了一下＜link＞标签的CSS路径。 
    
    （11）浏览器召集了在座的各位<div><span><ul><li>们，“大伙儿收拾收拾行李，咱得重新来过……”，浏览器向服务器请求了新的CSS文件，重新渲染页面。

#### 4.断开连接（TCP-四次挥手）

    （1）浏览器向服务器发送一个断开连接的请求（不早了，我该走了）；
    （2）服务器接到请求后发送确认收到请求的信号（知道了）；
    （3）服务器向主机发送断开通知（我也该走了）；
    （4）浏览器接到断开通知后断开连接并反馈一个确认信号（嗯，好的），服务器收到确认信号后断开连接；

为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完毕，所有服务器先发送确认信号，等所有数据发送完毕后再同意断开。

### 二. 从浏览器中输入url到页面展示用到了哪些协议

- Ip协议（网络层）
- TCP协议（传输层）
- HTTP协议（应用层）








